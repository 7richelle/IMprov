{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Dashboard</title>
  <link rel="stylesheet" href="{% static 'task_dashboard.css' %}">
</head>

<body>

<div class="dashboard">

  <!-- PREMIUM HEADER -->
  <header class="top-bar premium-header">
    <div class="left-side">
      <span class="logo">‚ú®</span>
      <a href="{% url 'task_dashboard' %}" class="nav-btn active">Home</a>
    </div>

    <nav class="nav-menu">
      <a href="{% url 'leaderboard' %}" class="nav-item">Leaderboard</a>
      <a href="{% url 'task_summary' %}" class="nav-item">Summary</a>
      <a href="{% url 'user_progress' %}" class="nav-item">Progress</a>
      <a href="{% url 'profile_user' %}" class="nav-item">Profile</a>

      <form action="{% url 'login' %}" method="post" class="logout-form">
        {% csrf_token %}
        <button type="submit" class="logout-btn">Logout</button>
      </form>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="task-container">
    
    <div class="pyramid-card-wrapper">
    <div class="pyramid-card">
    
    <h1 class="improv-title">IMprov</h1>
    <div class="shine"></div>
    <h2>Your Journey to Improvement Starts Here.</h2>
    </div>
    </div>
    <h1 class="premium-title">üéØ Generate Your Task</h1>

    <form onsubmit="event.preventDefault(); generateTask();" class="task-form fade-up">

      <!-- TASK TYPE -->
      <section class="task-section card-glass">
        <h2>Choose your type of task</h2>
        <div class="task-type">
          
          <label class="option-card glass-option">
            <input type="radio" name="type" value="stationary" required>
            <div class="option-content">
              <div class="icon gold-text">ü™ë</div>
              <h3>Stationary</h3>
              <p>Tasks done while sitting or minimal movement.</p>
            </div>
          </label>

          <label class="option-card glass-option">
            <input type="radio" name="type" value="active">
            <div class="option-content">
              <div class="icon gold-text">üèÉ</div>
              <h3>Active</h3>
              <p>Tasks involving movement and energy.</p>
            </div>
          </label>

        </div>
      </section>

      <!-- DIFFICULTY -->
      <section class="task-section card-glass">
        <h2>Choose difficulty level</h2>
        <div class="difficulty">
          
          <label class="difficulty-btn glass-btn">
            <input type="radio" name="difficulty" value="easy" required>
            <span>Easy<br><small>Laid-back and relaxing</small></span>
          </label>

          <label class="difficulty-btn glass-btn">
            <input type="radio" name="difficulty" value="medium">
            <span>Medium<br><small>Balanced and engaging</small></span>
          </label>

          <label class="difficulty-btn glass-btn">
            <input type="radio" name="difficulty" value="hard">
            <span>Hard<br><small>Challenge accepted</small></span>
          </label>

        </div>
      </section>



      <!-- DURATION -->
      <section class="task-section card-glass">
        <h2>‚è± Task Duration</h2>
        <p>How long do you want to spend?</p>

        <div class="difficulty">

          <label class="difficulty-btn glass-btn">
            <input type="radio" name="duration" value="5min" required>
            <span>5 mins<br><small>Quick boost</small></span>
          </label>

          <label class="difficulty-btn glass-btn">
            <input type="radio" name="duration" value="10min">
            <span>10 mins<br><small>Short focus</small></span>
          </label>

          <label class="difficulty-btn glass-btn">
            <input type="radio" name="duration" value="30min">
            <span>30 mins<br><small>Deep work</small></span>
          </label>

          <label class="difficulty-btn glass-btn">
            <input type="radio" name="duration" value="1hr">
            <span>1 hour<br><small>Power session</small></span>
          </label>

        </div>
      </section>

      <button type="submit" class="next-btn premium-btn">Generate Task</button>

    </form>

    <div id="output" class="output"></div>

  </main>

</div>

<!-- JAVASCRIPT unchanged -->
<script>
  async function generateTask() {
    const type = document.querySelector('input[name="type"]:checked')?.value;
    const difficulty = document.querySelector('input[name="difficulty"]:checked')?.value;
    
    const duration = document.querySelector('input[name="duration"]:checked')?.value;

    if (!type || !difficulty || !duration) {
      document.getElementById("output").innerHTML = "‚ö†Ô∏è Please fill out all fields.";
      return;
    }

    const email = "{{ user_email }}";
    document.getElementById("output").innerHTML = "‚è≥ Generating task...";

    try {
      const res = await fetch("/generate-task/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ type, difficulty, duration, email })
      });

      const data = await res.json();
      if (data.success) {
        const task = encodeURIComponent(data.generated_task);
        window.location.href = `/result/?task=${task}&duration=${duration}&task_id=${data.task_id}`;
      } else {
        document.getElementById("output").innerHTML =
          `‚ùå Error: ${data.error || "Task generation failed"}`;
      }
    } catch (err) {
      console.error(err);
      document.getElementById("output").innerHTML = "‚ö†Ô∏è Failed to reach server.";
    }
  }
</script>

</body>
</html>
